/* =====================================================
   Когноз TM1 Квиз — ПОЛНЫЙ СТИЛЬ (two-row topbar)
   ===================================================== */

/* ---------- Theme variables ---------- */
:root{
  --bg: #0e1117;
  --panel: #161b22;
  --panel-2: #1f2630;
  --text: #e6edf3;
  --muted: #9da7b3;
  --primary: #7c9cff;
  --primary-700: #648bff;
  --accent: #ffd166;
  --success: #41d497;
  --danger: #ff6b6b;

  --border: #2a3443;

  /* fail-screen colors */
  --fail-bg1: #1a1620;
  --fail-bg2: #0f1018;
  --fail-border: #3a2430;
  --fail-shadow: rgba(255, 107, 107, .18);
  --fail-title: #ffd1d1;
  --fail-muted-text: #ef9a9a;
}
:root[data-theme="light"]{
  --bg: #e5e7eb;
  --panel: #f3f4f6;
  --panel-2: #e8eaee;
  --text: #1f2937;
  --muted: #6b7280;
  --primary: #3b82f6;
  --primary-700: #2563eb;
  --accent: #f59e0b;
  --success: #10b981;
  --danger: #ef4444;
  --border: #d1d5db;
}

/* ---------- Base ---------- */
*{ box-sizing:border-box; }
html,body{ height:100%; }
body{
  margin:0;
  font-family:'Nunito',system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
  color:var(--text);
  background: radial-gradient(1200px 800px at 70% -10%, #1b2230 0%, var(--bg) 60%);
  overflow-x:hidden;
}
:root[data-theme="light"] body{
  background: radial-gradient(1200px 800px at 70% -10%, #f3f4f6 0%, var(--bg) 60%);
}

#app{ min-height:100dvh; display:grid; }
.container{ max-width: 1100px; margin:0 auto; padding:24px; }

.screen{ display:none; }
.screen.active{ display:block; }

/* ---------- Preloader ---------- */
.preload-screen{
  position:fixed; inset:0;
  display:flex; align-items:center; justify-content:center;
  background:var(--bg);
  z-index:9999;
}
.preload-logo{
  display:none;
  max-width: 80vw;
  max-height: 80vh;
  transform: scale(.92);
  opacity: 0;
  animation: preloadFadeIn 1s ease forwards;
}
@keyframes preloadFadeIn{
  from{ opacity:0; transform:scale(.9); }
  to{ opacity:1; transform:scale(1); }
}
:root[data-theme="light"] .logo-light{ display:block; }
:root[data-theme="dark"]  .logo-dark { display:block; }

/* ---------- Header (start screen) ---------- */
.header{ text-align:center; margin:16px 0 24px; }
.app-title{ margin:0 0 6px; font-size:32px; letter-spacing:.3px; }
.subtitle{ margin:0; color:var(--muted); }

.header .toggles{ margin-top: 10px; display:inline-flex; gap:8px; }

/* Player name */
.start-form{ display:grid; gap:8px; justify-items:center; margin:14px 0 8px; }
.input-label{ font-weight:800; }
.input-row{ display:grid; grid-template-columns:1fr auto; gap:8px; width:min(520px,92%); }
.text-input{
  width:100%; padding:12px 14px; border-radius:12px;
  border:1.5px solid var(--border); background:#121722; color:var(--text);
  box-shadow: 0 6px 16px rgba(0,0,0,.18) inset;
}
:root[data-theme="light"] .text-input{
  background:#fff; color:#111827; box-shadow: 0 2px 4px rgba(0,0,0,.06) inset;
}
.text-input:focus{ outline:none; border-color:var(--primary); }
.text-input.error{ border-color:var(--danger); box-shadow:0 0 0 3px rgba(255,107,107,.2); }
.best-note{ color:var(--muted); font-size:14px; min-height:18px; }

/* ---------- Dino select ---------- */
.dino-select-grid{
  display:grid; grid-template-columns: repeat(3,minmax(0,1fr));
  gap:16px; margin-top:24px;
}
.dino-card{
  appearance:none; border:2px solid transparent; border-radius:16px;
  background: linear-gradient(180deg, var(--panel) 0%, var(--panel-2) 100%);
  color:var(--text); padding:18px 16px; cursor:pointer; text-align:center;
  transition: transform .12s ease, box-shadow .12s ease, border-color .12s ease;
}
.dino-card[aria-pressed="true"], .dino-card:focus-visible{ border-color:var(--primary); outline:none; }
.dino-card:hover{ transform: translateY(-2px); box-shadow: 0 10px 24px rgba(0,0,0,.25); }

.dino-emoji{ font-size:56px; height:clamp(96px,16vw,160px); display:flex; align-items:center; justify-content:center; }
.dino-emoji img{ max-width:100%; max-height:100%; height:auto; width:auto; object-fit:contain; }
.dino-name{ font-weight:800; margin-top:8px; font-size:18px; }
.dino-desc{ margin:6px 0 0; color:var(--muted); }

/* ---------- Buttons ---------- */
.btn{
  appearance:none; border:0; border-radius:12px; padding:12px 18px;
  cursor:pointer; font-weight:700; background:var(--panel-2); color:var(--text);
  transition: transform .12s ease, background .12s ease, box-shadow .12s ease, opacity .12s ease;
}
.btn:hover{ transform: translateY(-1px); }
.btn:disabled{ opacity:.5; cursor:not-allowed; }
.btn.primary{ background: linear-gradient(180deg, var(--primary) 0%, var(--primary-700) 100%); color:#0a0f1a; }
.btn.ghost{ background:transparent; border:1.5px solid var(--border); }
.btn.danger{ background: linear-gradient(180deg, #ff8a80 0%, #e53935 100%); color:#fff; }
.btn.small{ padding:8px 12px; font-size:14px; line-height:1.2; display:inline-flex; align-items:center; gap:6px; }
.icon-btn{ padding:8px 10px; border-radius:10px; }

/* ---------- Topbar (two-row) ---------- */
.topbar{
  display:grid;
  grid-template-columns: auto 1fr auto auto; /* badge | progress | lives | exit */
  grid-template-areas:
    "badge progress lives exit"
    ".      .        score toggles";
  align-items:center;
  column-gap:12px; row-gap:6px;
  margin-bottom:16px;
}
.topbar > #player-badge{ grid-area: badge; }
.topbar > .progress{ grid-area: progress; min-width: 220px; }
.topbar > .lives{ grid-area: lives; white-space: nowrap; display:flex; gap:8px; align-items:center; }
.topbar > #exit-btn{ grid-area: exit; justify-self: start; }
.topbar > .score{ grid-area: score; align-self: start; white-space: nowrap; }
.topbar > .toggles{ grid-area: toggles; justify-self: end; display:inline-flex; gap:8px; white-space: nowrap; }
.topbar .toggle-wrap{ display:grid; justify-items:center; gap:4px; }
.topbar .toggle-label{ font-size:12px; color:var(--muted); line-height:1; }

.badge{
  background:#222a36; border:1px solid var(--border);
  border-radius:999px; padding:8px 12px; font-weight:700;
  display:inline-flex; align-items:center; gap:8px;
}

.progress{ display:grid; gap:6px; }
.progress-label{ color:var(--muted); font-size:14px; }
.progress-bar{ height:10px; background:#222a36; border-radius:999px; overflow:hidden; border:1px solid var(--border); }
#progress-fill{ height:100%; width:0%; background:linear-gradient(90deg, var(--accent), #ffa84d); transition:width .25s ease; }

.life{ width:18px; height:18px; display:inline-block; filter: drop-shadow(0 2px 4px rgba(0,0,0,.2)); }

/* Themed badge colors per dino (optional classes) */
.badge.focus{ background:#1f2a1f; border-color:#2e3f2e; color:#b9f6ca; }
.badge.logic{ background:#1f2735; border-color:#2a3a55; color:#c7d2fe; }
.badge.creo { background:#2a2020; border-color:#4a2e2e; color:#ffd7c2; }
:root[data-theme="light"] .badge{ background:#eef2ff; border-color:#dbe3ff; color:#111827; font-weight:800; }

@media (max-width: 860px){
  .topbar{
    grid-template-columns: 1fr 1fr;
    grid-template-areas:
      "badge exit"
      "progress progress"
      "lives lives"
      "score toggles";
  }
  .topbar > #exit-btn{ justify-self:end; }
}

@media (max-width: 720px){
  .container{ padding:20px 16px 28px; }
  .app-title{ font-size:26px; }
  .subtitle{ font-size:15px; }

  .start-form{ gap:10px; }
  .input-row{ grid-template-columns:1fr; width:100%; }
  .input-row .btn{ width:100%; justify-content:center; }
  .best-note{ text-align:center; }
  .header .toggles{ width:100%; justify-content:center; flex-wrap:wrap; }

  .dino-select-grid{ grid-template-columns: repeat(2,minmax(0,1fr)); gap:12px; }
  .dino-card{ padding:16px 14px; }
  .dino-emoji{ font-size:48px; }

  .quiz-layout{ grid-template-columns:1fr; gap:18px; }
  .dino-panel{ order:-1; grid-template-rows:auto auto auto auto; min-height:auto; }
  .dino-figure{ width: clamp(140px, 48vw, 240px); }

  #quiz-screen .container{
    min-height:100dvh;
    display:flex;
    flex-direction:column;
  }
  #quiz-screen .quiz-layout{
    flex:1;
    display:flex;
    flex-direction:column;
    gap:18px;
  }
  #quiz-screen .quiz-main{
    flex:1;
    display:flex;
    flex-direction:column;
    gap:16px;
  }
  #quiz-screen .quiz-card{
    flex:1;
    display:flex;
    flex-direction:column;
  }
  #quiz-screen .answers{
    flex:1;
  }
  #quiz-screen .actions{
    margin-top:auto;
  }

  .topbar{
    grid-template-columns:1fr;
    grid-template-areas:
      "badge"
      "progress"
      "lives"
      "score"
      "toggles"
      "exit";
    row-gap:10px;
  }
  .topbar > *{ justify-self:stretch; }
  .topbar > .progress{ min-width:0; }
  .topbar > .score{ text-align:left; }
  .topbar > .toggles{ justify-self:start; }
  .topbar .toggle-wrap{ align-items:start; }
  .topbar > #exit-btn{ justify-self:stretch; }

  .card{ padding:16px; }
  .answers{ gap:12px; }
  .actions{ flex-direction:column; }
  .actions .btn{ width:100%; }
}

@media (max-width: 480px){
  body{ background:var(--bg); }
  .container{ padding:16px 12px 24px; }
  .app-title{ font-size:24px; }
  .subtitle{ font-size:14px; }

  .dino-select-grid{ grid-template-columns:1fr; }
  .dino-card{ padding:14px 12px; }
  .dino-emoji{ font-size:42px; }

  .badge{ font-size:14px; padding:8px 10px; }
  .progress-label{ font-size:13px; }
  .lives{ gap:6px; }
  .score{ font-size:15px; }

  .dino-figure{ width: clamp(120px, 62vw, 200px); }
  .card h2{ font-size:20px; }
  .answer-btn{ font-size:15px; padding:12px; }
  .actions .btn{ max-width:340px; margin:0 auto; }
}

/* ---------- Quiz layout ---------- */
.quiz-layout{
  display:grid; grid-template-columns: 1fr 2fr; gap:16px; align-items:start;
}
.dino-panel{
  background: linear-gradient(180deg, var(--panel) 0%, var(--panel-2) 100%);
  border:1px solid var(--border); border-radius:16px; padding:18px;
  min-height: 320px;
  display:grid; grid-template-rows:auto auto auto 1fr; gap:8px; justify-items:center;
  position: relative;
}
.dino-mood-emoji{ position:absolute; right:12px; top:12px; font-size:22px; opacity:.9; }
.dino-figure{
  font-size:128px;
  line-height:1;
  transition: transform .2s ease, filter .2s ease;
  width: clamp(180px, 32vw, 360px);
}
.dino-figure img,
.dino-figure video{
  display:block;
  width: 100%;
  max-width: 100%;
  height:auto;
  object-fit:contain;
}
.dino-name-big{ font-weight:800; font-size:18px; color:var(--muted); text-align:center; }
.quiz-main{ min-width:0; }

/* Mood coloring */
.badge.sad{ background:#2a1f25; border-color:#5a2c35; }
.badge.happy{ background:#1e2a23; border-color:#2d4a3d; }

/* ---------- Cards & Answers ---------- */
.card{ background: linear-gradient(180deg, var(--panel) 0%, var(--panel-2) 100%);
  border:1px solid var(--border); border-radius:16px; padding:18px;
  box-shadow: 0 10px 24px rgba(0,0,0,.25);
}
.quiz-card h2{ margin-top:0; }

.card h2{ overflow-wrap:anywhere; }

.answers{ display:grid; gap:10px; margin-top:12px; }
.answer-btn{
  appearance:none; border:1.5px solid var(--border); border-radius:12px;
  padding:12px 14px; text-align:left; cursor:pointer;
  background:#1a2230; color:var(--text);
  transition: background .12s ease, transform .06s ease, border-color .12s ease;
  overflow-wrap:anywhere;
}
.answer-btn:hover{ transform: translateY(-1px); }
.answer-btn.correct{ background: rgba(65,212,151,.15); border-color: var(--success); }
.answer-btn.wrong{ background: rgba(255,107,107,.15); border-color: var(--danger); }
.answer-btn.disabled{ opacity:.65; pointer-events:none; }

/* ---------- Rewards ---------- */
.rewards-tray{ display:flex; flex-wrap:wrap; gap:6px; margin-top:8px; min-height:28px; justify-content:center; }
.reward-chip{ background:#222a36; border:1px solid var(--border); padding:6px 8px; border-radius:999px; font-size:13px; display:inline-flex; align-items:center; gap:6px; }
:root[data-theme="light"] .reward-chip{ background:#f1f5f9; border-color:#d1d5db; color:#111827; }

/* ---------- FX layers ---------- */
#fx-layer{ position:fixed; inset:0; pointer-events:none; }
.fx-pop{ position:absolute; animation: floatUp .9s ease forwards; filter: drop-shadow(0 4px 10px rgba(0,0,0,.35)); }
@keyframes floatUp{ from{ transform:translateY(0) scale(.9); opacity:.95; } to{ transform:translateY(-40px) scale(1.05); opacity:0; } }

.fx-firework{ position:absolute; width:6px; height:6px; border-radius:50%; background:#ffd166; animation: fw 800ms ease-out forwards; }
@keyframes fw{ 0%{ transform:translate(0,0) scale(1); opacity:1; } 100%{ transform:translate(var(--dx), var(--dy)) scale(.2); opacity:0; } }

.fx-flash{ position:absolute; inset:0; background:rgba(255,0,0,0.12); animation:flash 300ms ease-out forwards; }
.shake{ animation:shake 320ms ease-in-out; }
@keyframes shake{ 0%,100%{ transform:translateX(0); } 20%{ transform:translateX(-6px); } 40%{ transform:translateX(6px); } 60%{ transform:translateX(-4px); } 80%{ transform:translateX(4px); } }

/* ---------- Fail screen ---------- */
.fail-card{
  background: linear-gradient(180deg, var(--fail-bg1) 0%, var(--fail-bg2) 100%);
  border:1px solid var(--fail-border);
  box-shadow: 0 12px 28px var(--fail-shadow);
  text-align:center;
}
.skull-img{ width: clamp(120px, 22vw, 220px); height:auto; display:block; margin:8px auto 0; filter: drop-shadow(0 12px 24px var(--fail-shadow)); animation: skull-pop .4s cubic-bezier(.2,.8,.2,1); }
@keyframes skull-pop{ from{ transform:scale(.85); opacity:0; } to{ transform:scale(1); opacity:1; } }
.fail-title{ margin:8px 0 0; font-size:28px; letter-spacing:.2px; color:var(--fail-title); }
.fail-summary{ margin:8px 0 0; color:var(--fail-muted-text); }

/* ---------- Result & mistakes ---------- */
.result-card h2{ margin-top:0; }
.result-rewards{ display:flex; flex-wrap:wrap; gap:6px; margin-top:8px; }
.result-mistakes{ text-align:left; max-width:820px; margin:16px auto 0; }

.mistakes-list{ counter-reset: mis; display:grid; gap:12px; padding-left:0; margin:0; list-style:none; }
.mistake-item{
  position:relative; background:#151a24; border:1px solid var(--border); border-radius:14px;
  padding:12px 14px 12px 52px;
}
:root[data-theme="light"] .mistake-item{ background:#f9fafb; }

.mistake-item::before{
  counter-increment: mis; content: counter(mis);
  position:absolute; left:12px; top:12px;
  width:28px; height:28px; border-radius:8px; display:grid; place-items:center; font-weight:800;
  background:#222a36; color:#e6edf3; border:1px solid var(--border);
}
:root[data-theme="light"] .mistake-item::before{ background:#e5e7eb; color:#0f172a; border-color:#d1d5db; }

.mis-q{ margin:0 0 6px; font-weight:800; }
.mis-a{ margin:0; color:var(--muted); }

/* ---------- Modal (confirm exit) ---------- */
.modal{ position:fixed; inset:0; display:none; z-index:10000; }
.modal.open{ display:block; }
.modal-backdrop{
  position:absolute; inset:0;
  background: radial-gradient(800px 400px at 70% -10%, rgba(0,0,0,.35) 0%, rgba(0,0,0,.65) 60%);
  backdrop-filter: blur(2px);
}
.modal-dialog{
  position:absolute; left:50%; top:50%; transform:translate(-50%,-50%) scale(.95);
  width:min(520px,92%);
  background: linear-gradient(180deg, var(--panel) 0%, var(--panel-2) 100%);
  border:1px solid var(--border); border-radius:18px; padding:18px 18px 14px;
  box-shadow: 0 16px 36px rgba(0,0,0,.45);
  animation: modal-pop .18s ease-out forwards;
}
@keyframes modal-pop{ from{ transform:translate(-50%,-50%) scale(.9); opacity:.2; } to{ transform:translate(-50%,-50%) scale(1); opacity:1; } }
.modal-title{ margin:4px 0 4px; font-size:22px; text-align:center; }
.modal-text{ margin:0 0 12px; color:var(--muted); text-align:center; }
.modal-actions{ justify-content:center; }
.modal-illustration{ font-size:48px; text-align:center; margin:4px 0 6px; filter: drop-shadow(0 6px 16px rgba(0,0,0,.35)); }
:root[data-theme="light"] .modal-dialog{ border-color:#d1d5db; box-shadow:0 12px 24px rgba(0,0,0,.16); }

/* ---------- Win canvas ---------- */
#win-canvas{ position:fixed; inset:0; pointer-events:none; z-index:50; }

/* ---------- Misc ---------- */
.actions{ display:flex; gap:12px; justify-content:center; margin-top:20px; }
.quiz-card, .result-card{ /* keep shadow tweaks for light mode */
}
:root[data-theme="light"] .quiz-card,
:root[data-theme="light"] .result-card,
:root[data-theme="light"] .dino-panel{
  border-color:#d1d5db; box-shadow: 0 8px 20px rgba(0,0,0,.06);
}
:root[data-theme="light"] .answer-btn{ background:#ffffff; border-color:#d1d5db; color:#0f172a; }
:root[data-theme="light"] .answer-btn.correct{ background:#ecfdf5; border-color:#10b981; }
:root[data-theme="light"] .answer-btn.wrong{ background:#fef2f2; border-color:#ef4444; }
:root[data-theme="light"] .dino-name-big{ color:#475569; }
:root[data-theme="light"] .progress-bar{ background:#e5e7eb; border-color:#e5e7eb; }

/* Utility */
.hidden{ display:none !important; }
